<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8" /><title>Emacs: the joy of reducing workflow friction with elisp</title><meta content="
base-uri        &apos;self&apos;;
form-action     &apos;self&apos;;
default-src     &apos;none&apos;;
script-src      &apos;self&apos;;
img-src         &apos;self&apos;;
font-src        &apos;self&apos;;
connect-src     &apos;self&apos;;
frame-src       https://example.andersmurphy.com https://checkboxes.andersmurphy.com https://www.youtube-nocookie.com;
style-src       &apos;self&apos; &apos;unsafe-inline&apos;
" http-equiv="Content-Security-Policy" /><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><link href="/styles.css" rel="stylesheet" type="text/css" /><link href="/assets/favicon.png" rel="shortcut icon" /><link href="/feed.xml" rel="alternate" title="Blog Posts" type="application/rss+xml" /><script defer="defer" src="/toggle.js"></script><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="same-origin" name="view-transition" /><meta content="A blog mostly about Clojure programming" name="description" /></head><body><header class="nav-sticky-top container-fluid"><nav class="container"><ul><li><div class="linkify" style="align-items:center;display:flex;"><img alt="portrait" height="40px" src="/assets/avatar.png" style="image-rendering:pixelated;padding:4px;" width="40px" /><h1 style="margin-bottom:0;">anders murphy</h1><a aria-label="Home" href="/"></a></div></li></ul><ul><li><a aria-label="Github" class="contrast no-chaos" href="https://github.com/andersmurphy"><svg class="icon" height="24" style="margin-bottom:6px;margin-top:6px;" viewBox="0 0 496 512" width="24" xmlns="http://www.w3.org/2000/svg"><linearGradient id="gradient-horizontal"><stop offset="0%" stop-color="var(--color-stop-1)"></stop><stop offset="33%" stop-color="var(--color-stop-2)"></stop><stop offset="66%" stop-color="var(--color-stop-3)"></stop><stop offset="100%" stop-color="var(--color-stop-4)"></stop></linearGradient><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li><li><a aria-label="RSS" class="contrast no-chaos" href="/feed.xml"><svg class="icon" height="24" style="margin-bottom:6px;margin-top:6px;" viewBox="0 0 16 16" width="24" xmlns="http://www.w3.org/2000/svg"><linearGradient id="gradient-horizontal"><stop offset="0%" stop-color="var(--color-stop-1)"></stop><stop offset="33%" stop-color="var(--color-stop-2)"></stop><stop offset="66%" stop-color="var(--color-stop-3)"></stop><stop offset="100%" stop-color="var(--color-stop-4)"></stop></linearGradient><path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm1.5 2.5c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1 0-2m0 4a6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1 0-2m.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"></path></svg></a></li><li><div class="theme-toggle" id="toggle"><svg aria-hidden="true" class="icon theme-toggle__inner-moon" height="30" viewBox="0 0 32 32" width="30" xmlns="http://www.w3.org/2000/svg"><path d="M27.5 11.5v-7h-7L16 0l-4.5 4.5h-7v7L0 16l4.5 4.5v7h7L16 32l4.5-4.5h7v-7L32 16l-4.5-4.5zM16 25.4a9.39 9.39 0 1 1 0-18.8 9.39 9.39 0 1 1 0 18.8z"></path><circle cx="16" cy="16" r="8.1"></circle></svg></div></li></ul></nav></header><main class="container"><article><hgroup><h1>Emacs: the joy of reducing workflow friction with elisp</h1><p><time datetime="2021-11-30T00:00:00+00:00">30 Nov 2021</time></p></hgroup><hr /><p>Emacs is an interactive, self-documenting and extensible elisp interpreter. This makes it surprisingly enjoyable to extend. It goes something like this: you notice some friction when using a command, you use Emacs' self-documenting features to learn about the command, you investigate the source, you write some elisp, you evaluate it and you try the new and improved command out (all without ever having to restart Emacs).</p><p>Over time you get more adventurous as your knowledge of Emacs and elisp grows. Your write commands that reach further, you put up with less and less friction after all this is your development environment why not make yourself at home? You've also somehow become surprisingly good at elisp. For me this is the magic of Emacs.</p><p>Let's walk through an example.</p><h2 id="identify_friction">Identify friction</h2><p>You know when you copy something with <code>ctrl+v/cmd+v</code> and realise too late that you've now lost the previous thing you had copied? Well Emacs doesn't have that problem because all your copies get added to a list that you can cycle through by pressing <code>M-y</code> (<code>alt+y/opt+v</code>). This is a fantastic feature, but it only work when you press it straight after pasting some text. In this example that awkwardness is the friction we want to remove.</p><h2 id="imagine_how_it_should_work">Imagine how it should work</h2><p>What if when we called the paste command consecutively it started cycling through the list of copies? Rather than inserting another copy.</p><p>What behaviour would this proposed solution interfere with? Pasting the same thing multiple times in a row? How often do you paste the same thing multiple times in a row? In my case almost never, even then I would probably issue a different command between pastes. So in theory this will be a net improvement to my workflow (it doesn't always play out like this in practice).</p><h2 id="explore_documentation_and_source">Explore documentation and source</h2><p>Lets find out what function is called when we type <code>M-y</code>. We can ask Emacs to describe a key by typing <code>C-h k</code> followed by the keys we want to describe, in this case <code>M-y</code>. This will bring up a help buffer with useful information about that key.</p><pre><code>M-y runs the command yank-pop &#40;found in global-map&#41;, which is an
interactive compiled Lisp function in ‘simple.el’.
</code></pre><p><code>yank-pop</code> is the name of the function called when we press <code>M-y</code>. <code>yank</code> is Emacs name for paste. Emacs has arcane names for things as many of the names we use in software today like copy and paste were not standard when these features were implemented in Emacs.</p><p>This help buffer also has a direct link to the function in the <code>simple.el</code> source file. If we follow that link we will be able to see the elisp implementation.</p><pre><code class="elisp"><span class="dim">&#40;</span>defun <strong>yank-pop</strong> <span class="dim">&#40;</span>&amp;optional arg<span class="dim">&#41;</span>
  &quot;Replace just-yanked stretch<span class="dim">...</span>
  <span class="dim">&#40;</span>interactive &quot;p&quot;<span class="dim">&#41;</span>
  <span class="dim">&#40;</span>if <span class="dim">&#40;</span>not <span class="dim">&#40;</span>eq last-command 'yank<span class="dim">&#41;&#41;</span>
      <span class="dim">...</span><span class="dim">&#41;&#41;</span>
</code></pre><p>From this source code we can see how to call different functions based on the last command. Let's see the documentation for <code>last-command</code> by typing <code>C-h v last-command</code>.</p><pre><code>...

The last command executed.
Normally a symbol with a function definition, but can be whatever was found
in the keymap, or whatever the variable ‘this-command’ was set to by that
command.

...
</code></pre><p>We now have enough understanding to start writing some elisp code.</p><h2 id="write_some_elisp">Write some elisp</h2><p>Putting this all together we can create a new function called <code>yank++</code>. We do this in the <code>&#42;scratch&#42;</code> buffer. This is a elisp buffer for writing, evaluating and testing arbitrary elisp code.</p><pre><code class="elisp"><span class="dim">&#40;</span>defun <strong>yank++</strong> <span class="dim">&#40;</span><span class="dim">&#41;</span>
  &quot;Like 'yank'. But calling 'yank' again will call 'yank-pop'.&quot;
  <span class="dim">&#40;</span>interactive<span class="dim">&#41;</span>
  <span class="dim">&#40;</span>if <span class="dim">&#40;</span>member last-command '<span class="dim">&#40;</span>yank yank-pop<span class="dim">&#41;&#41;</span>
      <span class="dim">&#40;</span>yank-pop<span class="dim">&#41;</span>
    <span class="dim">&#40;</span>yank<span class="dim">&#41;&#41;&#41;</span>
</code></pre><p>This function calls <code>yank-pop</code> if the value of <code>last-command</code> is a <code>member</code> of the list <code>&#40;yank yank-pop&#41;</code> i.e the last command was <code>yank</code> or <code>yank-pop</code>. Otherwise it calls <code>yank</code>.</p><h2 id="evaluate%2C_bind_and_test_the_function">Evaluate, bind and test the function</h2><p>Place the cursor at the end of the <code>yank++</code> function (the <code>|</code> symbol below represents the cursor) and type <code>C-x C-e</code> to evaluate the code. This will 'load' this new function into Emacs.</p><pre><code class="elisp"><span class="dim">&#40;</span>defun <strong>yank++</strong> <span class="dim">&#40;</span><span class="dim">&#41;</span>
  &quot;Like 'yank'. But calling 'yank' again will call 'yank-pop'.&quot;
  <span class="dim">&#40;</span>interactive<span class="dim">&#41;</span>
  <span class="dim">&#40;</span>if <span class="dim">&#40;</span>member last-command '<span class="dim">&#40;</span>yank yank-pop<span class="dim">&#41;&#41;</span>
      <span class="dim">&#40;</span>yank-pop<span class="dim">&#41;</span>
    <span class="dim">&#40;</span>yank<span class="dim">&#41;&#41;&#41;</span>|
</code></pre><p>To bind the function to a key write the following elisp code and evaluate it like we did above with <code>C-x C-e</code>.</p><pre><code class="elisp"><span class="dim">&#40;</span>global-set-key <span class="dim">&#40;</span>kbd &quot;C-y&quot;<span class="dim">&#41;</span> 'yank++<span class="dim">&#41;</span>
</code></pre><p>Now try pasting something with <code>C-y</code> and see what happens when you press it multiple times. You should see it cycle through all the things you have previously copied.</p><p>Once you are happy with the results you can persist these changes by adding both the <code>yank++</code> function and the key-binding to your <code>init.el</code> file.</p><h2 id="profit">Profit</h2><p>This example barely scratches the surface of what you can do when extending Emacs. But hopefully it still illustrates a valuable point.</p><p>Emacs is great at reducing friction because there is so little friction to extending Emacs. The distance between an idea and a working implementation is so short you barely have to reach. In Emacs friction is only a problem so long as you don't notice it. The minute you do you can spend a few minute writing elisp and make it disappear.</p></article><footer><p>© 2015-2025 Anders Murphy</p></footer></main></body></html>