<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8" /><title>Clojure: generating HTML and XML</title><meta content="
base-uri    &apos;self&apos;;
form-action &apos;self&apos;;
default-src &apos;none&apos;;
script-src  &apos;self&apos;;
img-src     &apos;self&apos;;
font-src    &apos;self&apos;;
connect-src &apos;self&apos;;
style-src   &apos;self&apos; &apos;unsafe-inline&apos;
" http-equiv="Content-Security-Policy" /><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><link href="/styles.css" rel="stylesheet" type="text/css" /><link href="/assets/favicon.png" rel="shortcut icon" /><script src="/toggle.js"></script><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="A blog mostly about programming." name="description" /></head><body><nav class="container"><ul><li><div class="linkify" style="align-items:center;display:flex;"><img alt="portrait" height="40px" src="/assets/avatar.png" style="image-rendering:pixelated;padding:4px;" width="40px" /><h1 style="margin-bottom:0;">anders murphy</h1><a href="/"></a></div></li></ul><ul><li><a aria-label="Github" class="contrast no-chaos" href="https://github.com/andersmurphy"><svg class="icon" height="24" style="margin-bottom:6px;margin-top:6px;" viewBox="0 0 496 512" width="24" xmlns="http://www.w3.org/2000/svg"><linearGradient id="gradient-horizontal"><stop offset="0%" stop-color="var(--color-stop-1)"></stop><stop offset="33%" stop-color="var(--color-stop-2)"></stop><stop offset="66%" stop-color="var(--color-stop-3)"></stop><stop offset="100%" stop-color="var(--color-stop-4)"></stop></linearGradient><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li><li><a aria-label="RSS" class="contrast no-chaos" href="/feed.xml"><svg class="icon" height="24" style="margin-bottom:6px;margin-top:6px;" viewBox="0 0 16 16" width="24" xmlns="http://www.w3.org/2000/svg"><linearGradient id="gradient-horizontal"><stop offset="0%" stop-color="var(--color-stop-1)"></stop><stop offset="33%" stop-color="var(--color-stop-2)"></stop><stop offset="66%" stop-color="var(--color-stop-3)"></stop><stop offset="100%" stop-color="var(--color-stop-4)"></stop></linearGradient><path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm1.5 2.5c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1 0-2m0 4a6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1 0-2m.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"></path></svg></a></li><li><div class="theme-toggle" id="toggle"><svg aria-hidden="true" class="icon theme-toggle__inner-moon" height="30" viewBox="0 0 32 32" width="30" xmlns="http://www.w3.org/2000/svg"><path d="M27.5 11.5v-7h-7L16 0l-4.5 4.5h-7v7L0 16l4.5 4.5v7h7L16 32l4.5-4.5h7v-7L32 16l-4.5-4.5zM16 25.4a9.39 9.39 0 1 1 0-18.8 9.39 9.39 0 1 1 0 18.8z"></path><circle cx="16" cy="16" r="8.1"></circle></svg></div></li></ul></nav><div class="container"><article><hgroup><h1>Clojure: generating HTML and XML</h1><p><time datetime="2019-09-08T00:00:00+00:00">08 Sep 2019</time></p></hgroup><hr /><p>HTML and XML are ubiquitous, whether it's the pages of a static site or configuration for a logger, being able to programmatically generate these files can be really powerful. This article will cover how to generate HTML and XML files in Clojure.</p><h2 id="html">HTML</h2><p>In some languages you use template (<a href='https://ruby-doc.org/stdlib-2.6.4/libdoc/erb/rdoc/ERB.html'>ERB</a>) to generate HTML/XML or a language syntax extension (<a href='https://reactjs.org/docs/introducing-jsx.html'>JSX</a>). Inevitably, as you need to solve more and more interesting problems, the limitations of these template/extension languages become an issue. Eventually, you either live with those limitations or the template/extension language ends up being a super set of the language they are extending. Effectively, the templating language implements the underlying language in addition to it's own syntax, often with some awkward differences.</p><p>Clojure takes a different approach, rather than implementing a new embedded syntax it represents HTML and XML with Clojure data structures (vectors and maps). This gives you all the power of Clojure for manipulating and building HTML and XML files. This is possible as Lisp and HTML/XML are both trees that represent data. For a more in depth discussion on the similarities between Lisp and XML check out <a href='https://www.defmacro.org/ramblings/lisp.html'>this</a> article.</p><p>For generating HTML we are going to use Hiccup. Hiccup is a library for representing HTML in Clojure. It uses vectors to represent elements, and maps to represent an element's attributes.</p><p>Add <code>hiccup</code> as a dependency in the project <code>deps.edn</code> file.</p><pre><code class="clojure">{:deps {hiccup {:mvn/version &quot;1.0.5&quot;}}}
</code></pre><p>Require <code>hiccup</code>.</p><pre><code class="clojure"><span class="dim">&#40;</span>ns <strong>html-and-xml-example.core</strong>
  <span class="dim">&#40;</span>:require &#91;hiccup.core :as html&#93;<span class="dim">&#41;&#41;</span>
</code></pre><p>The <code>html</code> function creates an HTML string representation of a 404 error page which we then <code>spit</code> into a file. Vectors are used to represent elements, keywords represent tags, and maps represent attributes. Interestingly this data representation is less verbose that HTML as closing tags are omitted. This example also illustrates the use of a variable <code>site-url</code> in the HTML data.</p><pre><code class="clojure"><span class="dim">&#40;</span>def <strong>site-url</strong> &quot;https://andersmurphy.com&quot;<span class="dim">&#41;</span>

<span class="dim">&#40;</span>defn <strong>generate-404-html</strong> &#91;&#93;
  <span class="dim">&#40;</span>html/html &#91;:html
              &#91;:body
               &#91;:h1 {:class &quot;post-title&quot;} &quot;404: Page not found&quot;&#93;
               &#91;:p &quot;Sorry, we've misplaced that URL or it's
                 pointing to something that doesn't exist.&quot;
                &#91;:a {:href site-url} &quot;Head back home&quot;&#93;
                &quot; to try finding it again.&quot;&#93;&#93;&#93;<span class="dim">&#41;&#41;</span>

<span class="dim">&#40;</span>defn <strong>write-404!</strong> &#91;html&#93;
  <span class="dim">&#40;</span>let &#91;path-name &quot;404.html&quot;&#93;
    <span class="dim">&#40;</span>spit path-name html<span class="dim">&#41;&#41;&#41;</span>

<span class="dim">&#40;</span>comment <span class="dim">&#40;</span>-&gt; <span class="dim">&#40;</span>generate-404-html<span class="dim">&#41;</span>
             write-404!<span class="dim">&#41;&#41;</span>
</code></pre><p>The generated output file <code>404.html</code> has the following content. Note that I have formatted the output for this blog post to make it human readable, the actual output is a single line without any white space.</p><pre><code class="html">&lt;html&gt;
 &lt;body&gt;
  &lt;h1 class=&quot;post-title&quot;&gt;404: Page not found&lt;/h1&gt;
   &lt;p&gt;Sorry, we've misplaced that URL or it's
pointing to something that doesn't exist.&lt;a href=&quot;https://andersmurphy.com&quot;&gt;Head back home&lt;/a&gt; to try finding it again.
  &lt;/p&gt;
 &lt;/body&gt;
&lt;/html&gt;
</code></pre><h2 id="xml">XML</h2><p>For generating XML we are going to use Clojure.data.xml. Clojure.data.xml is a library for representing XML in Clojure. It uses vectors to represent elements, and maps to represent an element's attributes (identical to Hiccup).</p><p>Add <code>clojure.data.xml</code> as a dependency in the project <code>deps.edn</code> file.</p><pre><code class="clojure">{:deps {hiccup               {:mvn/version &quot;1.0.5&quot;}
        org.clojure/data.xml {:mvn/version &quot;0.0.8&quot;}}}
</code></pre><p>Require <code>clojure.data.xml</code>.</p><pre><code class="clojure"><span class="dim">&#40;</span>ns <strong>html-and-xml-example.core</strong>
  <span class="dim">&#40;</span>:require &#91;hiccup.core :as html&#93;
            &#91;clojure.data.xml :as xml&#93;<span class="dim">&#41;&#41;</span>
</code></pre><p>The <code>sexp-as-element</code> function is used to generate an XML RSS feed. <code>map</code> iterates over a sequence of posts and generates the corresponding RSS items. There's nothing special about the syntax in this example, it's just regular Clojure. Finally, <code>emit</code> writes the XML to file.</p><pre><code class="clojure"><span class="dim">&#40;</span>def <strong>site-title</strong> &quot;Site Title&quot;<span class="dim">&#41;</span>
<span class="dim">&#40;</span>def <strong>site-rss</strong> <span class="dim">&#40;</span>str site-url &quot;/feed.xml&quot;<span class="dim">&#41;&#41;</span>
<span class="dim">&#40;</span>def <strong>site-description</strong> &quot;Site Description&quot;<span class="dim">&#41;</span>

<span class="dim">&#40;</span>defn <strong>generate-rss-xml</strong> &#91;posts&#93;
  <span class="dim">&#40;</span>xml/sexp-as-element
   &#91;:rss
    {:version    &quot;2.0&quot;
     :xmlns:atom &quot;https://www.w3.org/2005/Atom&quot;
     :xmlns:dc   &quot;https://purl.org/dc/elements/1.1/&quot;}
    &#91;:channel
     &#91;:title site-title&#93;
     &#91;:description site-description&#93;
     &#91;:link site-url&#93;
     &#91;:atom:link
      {:href site-rss :rel &quot;self&quot; :type &quot;application/rss+xml&quot;}&#93;
     <span class="dim">&#40;</span>map <span class="dim">&#40;</span>fn &#91;{:keys &#91;post-name date post-path-name&#93;}&#93;
            <span class="dim">&#40;</span>let &#91;post-url <span class="dim">&#40;</span>str site-url &quot;/&quot; post-path-name<span class="dim">&#41;</span>&#93;
              &#91;:item
               &#91;:title post-name&#93;
               &#91;:pubDate date&#93;
               &#91;:link post-url&#93;
               &#91;:guid {:isPermaLink &quot;true&quot;} post-url&#93;&#93;<span class="dim">&#41;&#41;</span>
          posts<span class="dim">&#41;</span>&#93;&#93;<span class="dim">&#41;&#41;</span>

<span class="dim">&#40;</span>def <strong>posts</strong> &#91;{:post-name      &quot;Foo&quot;
             :post-path-name &quot;foo&quot;
             :date           &quot;Fri, 6 Sep 2019 00:00:00 GMT&quot;}
            {:post-name      &quot;Bar&quot;
             :post-path-name &quot;bar&quot;
             :date           &quot;Sat, 7 Sep 2019 00:00:00 GMT&quot;}
            {:post-name      &quot;Baz&quot;
             :post-path-name &quot;baz&quot;
             :date           &quot;Sun, 8 Sep 2019 00:00:00 GMT&quot;}&#93;<span class="dim">&#41;</span>

<span class="dim">&#40;</span>defn <strong>write-rss!</strong> &#91;xml&#93;
  <span class="dim">&#40;</span>with-open &#91;out-file <span class="dim">&#40;</span>java.io.FileWriter. &quot;feed.xml&quot;<span class="dim">&#41;</span>&#93;
    <span class="dim">&#40;</span>xml/emit xml out-file<span class="dim">&#41;&#41;&#41;</span>

<span class="dim">&#40;</span>comment <span class="dim">&#40;</span>-&gt; <span class="dim">&#40;</span>generate-rss-xml posts<span class="dim">&#41;</span>
             write-rss!<span class="dim">&#41;&#41;</span>
</code></pre><p>The generated output file <code>feed.xml</code> has the following content. Note that I have formatted the output for this blog post to make it human readable, the actual output is a single line without any white space.</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;rss xmlns:atom=&quot;https://www.w3.org/2005/Atom&quot; xmlns:dc=&quot;https://purl.org/dc/elements/1.1/&quot; version=&quot;2.0&quot;&gt;
   &lt;channel&gt;
      &lt;title&gt;Site Title&lt;/title&gt;
      &lt;description&gt;Site Description&lt;/description&gt;
      &lt;link&gt;https://andersmurphy.com&lt;/link&gt;
      &lt;atom:link href=&quot;https://andersmurphy.com/feed.xml&quot; rel=&quot;self&quot; type=&quot;application/rss+xml&quot; /&gt;
      &lt;item&gt;
         &lt;title&gt;Foo&lt;/title&gt;
         &lt;pubDate&gt;Fri, 6 Sep 2019 00:00:00 GMT&lt;/pubDate&gt;
         &lt;link&gt;https://andersmurphy.com/foo&lt;/link&gt;
         &lt;guid isPermaLink=&quot;true&quot;&gt;https://andersmurphy.com/foo&lt;/guid&gt;
      &lt;/item&gt;
      &lt;item&gt;
         &lt;title&gt;Bar&lt;/title&gt;
         &lt;pubDate&gt;Sat, 7 Sep 2019 00:00:00 GMT&lt;/pubDate&gt;
         &lt;link&gt;https://andersmurphy.com/bar&lt;/link&gt;
         &lt;guid isPermaLink=&quot;true&quot;&gt;https://andersmurphy.com/bar&lt;/guid&gt;
      &lt;/item&gt;
      &lt;item&gt;
         &lt;title&gt;Baz&lt;/title&gt;
         &lt;pubDate&gt;Sun, 8 Sep 2019 00:00:00 GMT&lt;/pubDate&gt;
         &lt;link&gt;https://andersmurphy.com/baz&lt;/link&gt;
         &lt;guid isPermaLink=&quot;true&quot;&gt;https://andersmurphy.com/baz&lt;/guid&gt;
      &lt;/item&gt;
   &lt;/channel&gt;
&lt;/rss&gt;
</code></pre><p>This concludes this guide to generating HTML and XML in Clojure. The full <a href='https://github.com/andersmurphy/clj-cookbook/tree/master/generating-files/html-and-xml-example'>example project can be found here</a>.</p></article><footer><p>© 2015-2024 Anders Murphy</p></footer></div></body></html>