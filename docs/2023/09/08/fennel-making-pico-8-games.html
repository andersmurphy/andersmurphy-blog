<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8" /><title>Fennel: making PICO-8 games</title><meta content="
base-uri    &apos;self&apos;;
form-action &apos;self&apos;;
default-src &apos;none&apos;;
script-src  &apos;self&apos;;
img-src     &apos;self&apos;;
font-src    &apos;self&apos;;
connect-src &apos;self&apos;;
style-src   &apos;self&apos; &apos;unsafe-inline&apos;
" http-equiv="Content-Security-Policy" /><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><link href="/styles.css" rel="stylesheet" type="text/css" /><link href="/assets/favicon.png" rel="shortcut icon" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="A blog mostly about software development." name="description" /></head><body><nav class="container"><ul><li><div style="align-items:center;display:flex;"><img alt="portrait" height="40px" src="/assets/avatar.png" style="image-rendering:pixelated;padding:4px;" width="40px" /><h1 style="margin-bottom:0;"><a class="contrast" href="/">anders murphy</a></h1></div></li></ul><ul><li><a aria-label="Github" class="contrast no-chaos" href="https://github.com/andersmurphy"><svg class="icon-github" height="24" viewBox="0 0 496 512" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li><li><a aria-label="Twitter" class="contrast no-chaos" href="https://twitter.com/anders_murphy"><svg class="icon-x" height="24" viewBox="0 0 512 512" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg></a></li><li><a aria-label="LinkedIn" class="contrast no-chaos" href="https://uk.linkedin.com/in/anders-murphy-76457b3a"><svg class="linkedin" fill="currentColor" height="24" viewBox="0 0 16 16" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"></path></svg></a></li><li><a aria-label="RSS" class="contrast no-chaos" href="/feed.xml"><svg class="bi bi-rss-fill" fill="currentColor" height="24" viewBox="0 0 16 16" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm1.5 2.5c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1 0-2m0 4a6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1 0-2m.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"></path></svg></a></li></ul></nav><div class="container"><article><hgroup><h1>Fennel: making PICO-8 games</h1><p><time datetime="2023-09-08T00:00:00+00:00">08 Sep 2023</time></p></hgroup><hr /><p>I recently wrote <a href='https://andersmurphy.itch.io/staglight'>a game jam game</a> for <a href='https://www.lexaloffle.com/pico-8.php'>PICO-8</a> using <a href='https://fennel-lang.org'>Fennel</a>. This post goes over setting up a project to write PICO-8 games in Fennel.</p><p>PICO-8 is a fantastic game engine for game jams due to its constraints:</p><pre><code>Display: 128x128, fixed 16 colour palette
Input:   6-button controllers
Carts:   32k data encoded as png files
Sound:   4 channel, 64 definable chip blerps
Code:    P8 Lua &#40;max 8192 tokens of code&#41;
CPU:     4M vm insts/sec
Sprites: Single bank of 128 8x8 sprites &#40;+128 shared&#41;
Map:     128 x 32 Tilemap &#40;+ 128 x 32 shared&#41;
</code></pre><p>These constraints help you avoid over scoping your project which makes you more likely to finish the game in the time constraints of the game jam.</p><p>PICO-8 games are written in Lua. Lua is great: tables, first class functions, first class coroutines to name but a few of its awesome features. However, since I mostly write Clojure these days, I've long forgotten how to navigate and edit code without <a href='http://danmidwood.com/content/2014/11/21/animated-paredit.html'>paredit</a>. Enter Fennel, a programming language that brings together the speed, simplicity, and reach of Lua with the flexibility of a lisp syntax and macro system.</p><p>I'm only going to cover the key parts of getting PICO-8 working with Fennel in this post (<a href='https://github.com/andersmurphy/fennel-pico-8-example'>you can find the full example project here</a>).</p><h2 id="project_structure">Project structure</h2><p>The example project is structured as follows. </p><pre><code>├── Makefile
├── README.md
├── fennel
├── fnl
│   └── your-game-name.fnl
└── games
    ├── lua
    │   └── your-game-name.lua
    └── your-game-name.p8
</code></pre><p>For the <code>make</code> script to run you will need a <code>fnl/your-game-name.fnl</code> file and <code>games/lua/your-game-name.lua</code>. We also need a <code>games/your-game-name.p8</code> file with the following contents:</p><pre><code>pico-8 cartridge // http://www.pico-8.com
version 41
&#95;&#95;lua&#95;&#95;
#include lua/your-game-name.lua
</code></pre><p>Where <code>your-game-name</code> is the name of your game.</p><h2 id="symlink">Symlink</h2><p>To make it easy for  PICO-8  to access your games <code>.p8</code> without having to store the entire project directly in your PICO-8 <code>carts</code>  folder we symlink the project's games directory to the PICO-8 carts folder. In my case on OSX this would be:</p><pre><code>ln -s &#126;/projects/fennel-pico-8-example/games '&#126;/Library/Application Support/pico-8/carts/games'
</code></pre><h2 id="makefile">Makefile</h2><p>The last piece of the puzzle is the <code>Makefile</code>. Fennel offers ahead-of-time compilation for when the target system of your application does not make it easy to include the Fennel compiler directly but uses Lua. This allows you to compile .fnl files to .lua files that can be included in your PICO-8 <code>.p8</code> cart.</p><pre><code>all: games/lua/&#42;.lua

games/lua/%.lua: fnl/%.fnl
# Compile fennel code to lua
		./fennel/fennel --compile $&lt; &gt; $@
# Remove the module return statement generated by fennel
# &#40;the last line of the output .lua file&#41; as pico-8 doesn't
# support return statements outside of functions.
		sed -i '' '$$d' $@
</code></pre><p>You can then compile your <code>your-game-name.fnl</code> file by running <code>make</code> at  the root of the project.</p><p>You now have everything you need to make PICO-8 games in Fennel.</p><p>The full example <a href='https://github.com/andersmurphy/fennel-pico-8-example'>project can be found here</a>.</p></article><footer><p>© 2015-2024 Anders Murphy</p></footer></div></body></html>